model SubscriptionPlan {
  id                        String             @id @default(uuid())
  title                     String
  description               String?
  benefits                  String[]
  isPopular                 Boolean            @default(false)
  isActive                  Boolean            @default(true)
  stripeProductId           String             @unique
  stripePriceId             String             @unique
  currency                  String             @default("usd")
  priceCents                Int
  priceWithoutDiscountCents Int
  discountPercent           Int                @default(0)
  billingPeriod             BillingPeriod
  createdAt                 DateTime           @default(now())
  updatedAt                 DateTime           @default(now()) @updatedAt
  userSubscriptions         UserSubscription[]
  user                      User[]

  @@map("subscription_plans")
}

model UserSubscription {
  id                   String             @id @default(uuid())
  userId               String
  planId               String
  stripeSubscriptionId String?            @unique
  stripeTransactionId  String             @unique
  status               SubscriptionStatus @default(PENDING)
  planStartedAt        DateTime           @default(now())
  planEndedAt          DateTime
  paidAt               DateTime?
  failedAt             DateTime?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @default(now()) @updatedAt
  billingCycle         Int                @default(0)
  invoices             Invoice[]
  plan                 SubscriptionPlan   @relation(fields: [planId], references: [id], onDelete: Cascade)
  user                 User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([planId])
  @@map("user_subscriptions")
}

model Invoice {
  id              String           @id @default(uuid())
  stripeInvoiceId String           @unique
  currency        String           @default("usd")
  status          InvoiceStatus
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @default(now()) @updatedAt
  amount          Float
  dueAt           DateTime?
  failedAt        DateTime?
  paidAt          DateTime?
  subscriptionId  String
  userId          String
  subscription    UserSubscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("invoices")
}

enum BillingPeriod {
  MONTHLY
  BIANNUAL
  YEARLY
}

enum SubscriptionStatus {
  PENDING
  TRIALING
  ACTIVE
  CANCELED
  FAILED
}

enum InvoiceStatus {
  DRAFT
  PAID
  UNPAID
}
