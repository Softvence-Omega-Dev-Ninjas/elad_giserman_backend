model SubscriptionPlan {
  id String @id @default(uuid())

  title       String
  description String?
  benefits    String[] // text lines

  isPopular Boolean @default(false)
  isActive  Boolean @default(true)

  stripeProductId String @unique
  stripePriceId   String @unique

  currency String @default("usd")

  // monetary fields stored in smallest currency unit (cents)
  priceCents                Int // e.g., 999 = $9.99
  priceWithoutDiscountCents Int // original price in cents
  discountPercent           Int @default(0)

  billingPeriod BillingPeriod

  user              User[]
  userSubscriptions UserSubscription[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  @@map("subscription_plans")
}

model UserSubscription {
  id String @id @default(uuid())

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  planId String
  plan   SubscriptionPlan @relation(fields: [planId], references: [id], onDelete: Cascade)

  // Stripe subscription identifier (for recurring cancel/renew)
  stripeSubscriptionId String? @unique

  // Stripe setup intent identifier
  stripeTransactionId String @unique

  status SubscriptionStatus @default(PENDING)

  planStartedAt DateTime @default(now())
  planEndedAt   DateTime // calculated from billingPeriod (months)

  paidAt   DateTime?
  failedAt DateTime?

  invoices Invoice[] // invoices for this subscription period(s)

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  @@index([userId])
  @@index([planId])
  @@map("user_subscriptions")
}

enum BillingPeriod {
  MONTHLY // 1 month
  BIANNUAL // 6 months
  YEARLY // 12 months
}

enum SubscriptionStatus {
  PENDING // not yet paid
  TRIALING // during free trial
  ACTIVE // paid and active subscription
  CANCELED // user canceled
  FAILED // payment failed / incomplete
}
