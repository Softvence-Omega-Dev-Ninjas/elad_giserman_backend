api.yamiz.org {
  # tls internal

  reverse_proxy /socket.io* server:5050

  @api {
    not path /socket.io*
  }

  handle @api {
    # Allow up to 500MB upload
    request_body {
      max_size 500MB
    }

    reverse_proxy server:5050 {
      header_up X-Real-IP {remote}
      header_up X-Forwarded-For {remote}
      header_up X-Forwarded-Proto {scheme}
      header_up Host {host}
    }
  }
}

yamiz.org {
  # tls internal

  reverse_proxy frontend:3000
    
  header {
    Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Access-Control-Allow-Headers "*"
  }
  encode gzip
}